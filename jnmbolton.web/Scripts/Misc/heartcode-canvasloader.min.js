(function(n){"use strict";var o=function(n,t){typeof t=="undefined"&&(t={}),this.init(n,t)},t=o.prototype,f,e=["canvas","vml"],i=["oval","spiral","square","rect","roundRect"],v=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,c=navigator.appVersion.indexOf("MSIE")!==-1&&parseFloat(navigator.appVersion.split("MSIE")[1])===8?!0:!1,y=!!document.createElement("canvas").getContext,l=40,a=!0,u=function(n,t,i){var r=document.createElement(n),u;for(u in i)r[u]=i[u];return typeof t!="undefined"&&t.appendChild(r),r},r=function(n,t){for(var i in t)n.style[i]=t[i];return n},s=function(n,t){for(var i in t)n.setAttribute(i,t[i]);return n},h=function(n,t,i,r){n.save(),n.translate(t,i),n.rotate(r),n.translate(-t,-i),n.beginPath()};t.init=function(n,t){var s,i;typeof t.safeVML=="boolean"&&(a=t.safeVML);try{this.mum=document.getElementById(n)!==undefined?document.getElementById(n):document.body}catch(h){this.mum=document.body}if(t.id=typeof t.id!="undefined"?t.id:"canvasLoader",this.cont=u("div",this.mum,{id:t.id}),y)f=e[0],this.can=u("canvas",this.cont),this.con=this.can.getContext("2d"),this.cCan=r(u("canvas",this.cont),{display:"none"}),this.cCon=this.cCan.getContext("2d");else{if(f=e[1],typeof o.vmlSheet=="undefined")for(document.getElementsByTagName("head")[0].appendChild(u("style")),o.vmlSheet=document.styleSheets[document.styleSheets.length-1],s=["group","oval","roundrect","fill"],i=0;i<s.length;++i)o.vmlSheet.addRule(s[i],"behavior:url(#default#VML); position:absolute;");this.vml=u("group",this.cont)}this.setColor(this.color),this.draw(),r(this.cont,{display:"none"})},t.cont={},t.can={},t.con={},t.cCan={},t.cCon={},t.timer={},t.activeId=0,t.diameter=40,t.setDiameter=function(n){this.diameter=Math.round(Math.abs(n)),this.redraw()},t.getDiameter=function(){return this.diameter},t.cRGB={},t.color="#000000",t.setColor=function(n){this.color=v.test(n)?n:"#000000",this.cRGB=this.getRGB(this.color),this.redraw()},t.getColor=function(){return this.color},t.shape=i[0],t.setShape=function(n){var t;for(t in i)if(n===i[t]){this.shape=n,this.redraw();break}},t.getShape=function(){return this.shape},t.density=40,t.setDensity=function(n){this.density=a&&f===e[1]?Math.round(Math.abs(n))<=l?Math.round(Math.abs(n)):l:Math.round(Math.abs(n)),this.density>360&&(this.density=360),this.activeId=0,this.redraw()},t.getDensity=function(){return this.density},t.range=1.3,t.setRange=function(n){this.range=Math.abs(n),this.redraw()},t.getRange=function(){return this.range},t.speed=2,t.setSpeed=function(n){this.speed=Math.round(Math.abs(n))},t.getSpeed=function(){return this.speed},t.fps=24,t.setFPS=function(n){this.fps=Math.round(Math.abs(n)),this.reset()},t.getFPS=function(){return this.fps},t.getRGB=function(n){return n=n.charAt(0)==="#"?n.substring(1,7):n,{r:parseInt(n.substring(0,2),16),g:parseInt(n.substring(2,4),16),b:parseInt(n.substring(4,6),16)}},t.draw=function(){var w=0,a,p,n,o,l,tt,d,b,nt=this.density,it=Math.round(nt*this.range),k,rt=0,ft,et,ut,st,y=1e3,ot=0,v=this.cCon,t=this.diameter,g=.47;if(f===e[0])for(v.clearRect(0,0,y,y),s(this.can,{width:t,height:t}),s(this.cCan,{width:t,height:t});w<nt;){k=w<=it?1-(1-rt)/it*w:k=rt,tt=270-360/nt*w,d=tt/180*Math.PI,v.fillStyle="rgba("+this.cRGB.r+","+this.cRGB.g+","+this.cRGB.b+","+k.toString()+")";switch(this.shape){case i[0]:case i[1]:a=t*.07,o=t*g+Math.cos(d)*(t*g-a)-t*g,l=t*g+Math.sin(d)*(t*g-a)-t*g,v.beginPath(),this.shape===i[1]?v.arc(t*.5+o,t*.5+l,a*k,0,Math.PI*2,!1):v.arc(t*.5+o,t*.5+l,a,0,Math.PI*2,!1);break;case i[2]:a=t*.12,o=Math.cos(d)*(t*g-a)+t*.5,l=Math.sin(d)*(t*g-a)+t*.5,h(v,o,l,d),v.fillRect(o,l-a*.5,a,a);break;case i[3]:case i[4]:p=t*.3,n=p*.27,o=Math.cos(d)*(n+(t-n)*.13)+t*.5,l=Math.sin(d)*(n+(t-n)*.13)+t*.5,h(v,o,l,d),this.shape===i[3]?v.fillRect(o,l-n*.5,p,n):(b=n*.55,v.moveTo(o+b,l-n*.5),v.lineTo(o+p-b,l-n*.5),v.quadraticCurveTo(o+p,l-n*.5,o+p,l-n*.5+b),v.lineTo(o+p,l-n*.5+n-b),v.quadraticCurveTo(o+p,l-n*.5+n,o+p-b,l-n*.5+n),v.lineTo(o+b,l-n*.5+n),v.quadraticCurveTo(o,l-n*.5+n,o,l-n*.5+n-b),v.lineTo(o,l-n*.5+b),v.quadraticCurveTo(o,l-n*.5,o+b,l-n*.5))}v.closePath(),v.fill(),v.restore(),++w}else{r(this.cont,{width:t,height:t}),r(this.vml,{width:t,height:t});switch(this.shape){case i[0]:case i[1]:ut="oval",a=y*.14;break;case i[2]:ut="roundrect",a=y*.12;break;case i[3]:case i[4]:ut="roundrect",a=y*.3}for(p=n=a,o=y*.5-n,l=-n*.5;w<nt;){k=w<=it?1-(1-rt)/it*w:k=rt,tt=270-360/nt*w;switch(this.shape){case i[1]:p=n=a*k,o=y*.5-a*.5-a*k*.5,l=(a-a*k)*.5;break;case i[0]:case i[2]:c&&(l=0,this.shape===i[2]&&(o=y*.5-n*.5));break;case i[3]:case i[4]:p=a*.95,n=p*.28,c?(o=0,l=y*.5-n*.5):(o=y*.5-p,l=-n*.5),ot=this.shape===i[4]?.6:0}et=s(r(u("group",this.vml),{width:y,height:y,rotation:tt}),{coordsize:y+","+y,coordorigin:-y*.5+","+-y*.5}),ft=r(u(ut,et,{stroked:!1,arcSize:ot}),{width:p,height:n,top:l,left:o}),st=u("fill",ft,{color:this.color,opacity:k}),++w}}this.tick(!0)},t.clean=function(){if(f===e[0])this.con.clearRect(0,0,1e3,1e3);else{var n=this.vml;if(n.hasChildNodes())while(n.childNodes.length>=1)n.removeChild(n.firstChild)}},t.redraw=function(){this.clean(),this.draw()},t.reset=function(){typeof this.timer=="number"&&(this.hide(),this.show())},t.tick=function(n){var i=this.con,t=this.diameter;n||(this.activeId+=360/this.density*this.speed),f===e[0]?(i.clearRect(0,0,t,t),h(i,t*.5,t*.5,this.activeId/180*Math.PI),i.drawImage(this.cCan,0,0,t,t),i.restore()):(this.activeId>=360&&(this.activeId-=360),r(this.vml,{rotation:this.activeId}))},t.show=function(){if(typeof this.timer!="number"){var n=this;this.timer=self.setInterval(function(){n.tick()},Math.round(1e3/this.fps)),r(this.cont,{display:"block"})}},t.hide=function(){typeof this.timer=="number"&&(clearInterval(this.timer),delete this.timer,r(this.cont,{display:"none"}))},t.kill=function(){var n=this.cont,t;typeof this.timer=="number"&&this.hide(),f===e[0]?(n.removeChild(this.can),n.removeChild(this.cCan)):n.removeChild(this.vml);for(t in this)delete this[t]},n.CanvasLoader=o})(window);