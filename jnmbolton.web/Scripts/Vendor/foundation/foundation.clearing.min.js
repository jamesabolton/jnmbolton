(function(n,t,i,r){"use strict";Foundation.libs.clearing={name:"clearing",version:"4.1.3",settings:{templates:{viewing:'<a href="#" class="clearing-close">&times;<\/a><div class="visible-img" style="display: none"><img src="//:0"><p class="clearing-caption"><\/p><a href="#" class="clearing-main-prev"><span><\/span><\/a><a href="#" class="clearing-main-next"><span><\/span><\/a><\/div>'},close_selectors:".clearing-close",init:!1,locked:!1},init:function(t,i,r){var u=this;return Foundation.inherit(this,"set_data get_data remove_data throttle data_options"),typeof i=="object"&&(r=n.extend(!0,this.settings,i)),typeof i!="string"?(n(this.scope).find("ul[data-clearing]").each(function(){var t=n(this),i=i||{},r=t.find("li"),f=u.get_data(t);!f&&r.length>0&&(i.$parent=t.parent(),u.set_data(t,n.extend({},u.settings,i,u.data_options(t))),u.assemble(t.find("li")),u.settings.init||u.events().swipe_events())}),this.settings.init):this[i].call(this,r)},events:function(){var i=this;n(this.scope).on("click.fndtn.clearing","ul[data-clearing] li",function(t,r,u){var r=r||n(this),u=u||r,f=r.next("li"),o=i.get_data(r.parent()),e=n(t.target);t.preventDefault(),o||i.init(),u.hasClass("visible")&&r[0]===u[0]&&f.length>0&&i.is_open(r)&&(u=f,e=u.find("img")),i.open(e,r,u),i.update_paddles(u)}).on("click.fndtn.clearing",".clearing-main-next",function(n){this.nav(n,"next")}.bind(this)).on("click.fndtn.clearing",".clearing-main-prev",function(n){this.nav(n,"prev")}.bind(this)).on("click.fndtn.clearing",this.settings.close_selectors,function(n){Foundation.libs.clearing.close(n,this)}).on("keydown.fndtn.clearing",function(n){this.keydown(n)}.bind(this));n(t).on("resize.fndtn.clearing",function(){this.resize()}.bind(this));return this.settings.init=!0,this},swipe_events:function(){var t=this;n(this.scope).on("touchstart.fndtn.clearing",".visible-img",function(t){t.touches||(t=t.originalEvent);var i={start_page_x:t.touches[0].pageX,start_page_y:t.touches[0].pageY,start_time:(new Date).getTime(),delta_x:0,is_scrolling:r};n(this).data("swipe-transition",i),t.stopPropagation()}).on("touchmove.fndtn.clearing",".visible-img",function(i){var r,u;(i.touches||(i=i.originalEvent),i.touches.length>1||i.scale&&i.scale!==1)||(r=n(this).data("swipe-transition"),typeof r=="undefined"&&(r={}),r.delta_x=i.touches[0].pageX-r.start_page_x,typeof r.is_scrolling=="undefined"&&(r.is_scrolling=!!(r.is_scrolling||Math.abs(r.delta_x)<Math.abs(i.touches[0].pageY-r.start_page_y))),r.is_scrolling||r.active||(i.preventDefault(),u=r.delta_x<0?"next":"prev",r.active=!0,t.nav(i,u)))}).on("touchend.fndtn.clearing",".visible-img",function(t){n(this).data("swipe-transition",{}),t.stopPropagation()})},assemble:function(t){var i=t.parent();i.after('<div id="foundationClearingHolder"><\/div>');var u=n("#foundationClearingHolder"),f=this.get_data(i),e=i.detach(),r={grid:'<div class="carousel">'+this.outerHTML(e[0])+"<\/div>",viewing:f.templates.viewing},o='<div class="clearing-assembled"><div>'+r.viewing+r.grid+"<\/div><\/div>";return u.after(o).remove()},open:function(n,t,i){var f=i.closest(".clearing-assembled"),e=f.find("div").first(),u=e.find(".visible-img"),r=u.find("img").not(n);this.locked()||(r.attr("src",this.load(n)).css("visibility","hidden"),this.loaded(r,function(){r.css("visibility","visible"),f.addClass("clearing-blackout"),e.addClass("clearing-container"),u.show(),this.fix_height(i).caption(u.find(".clearing-caption"),n).center(r).shift(t,i,function(){i.siblings().removeClass("visible"),i.addClass("visible")})}.bind(this)))},close:function(t,i){t.preventDefault();var r=function(n){return/blackout/.test(n.selector)?n:n.closest(".clearing-blackout")}(n(i)),u,f;return i===t.target&&r&&(u=r.find("div").first(),f=u.find(".visible-img"),this.settings.prev_index=0,r.find("ul[data-clearing]").attr("style","").closest(".clearing-blackout").removeClass("clearing-blackout"),u.removeClass("clearing-container"),f.hide()),!1},is_open:function(n){return n.parent().attr("style").length>0},keydown:function(t){var i=n(".clearing-blackout").find("ul[data-clearing]");t.which===39&&this.go(i,"next"),t.which===37&&this.go(i,"prev"),t.which===27&&n("a.clearing-close").trigger("click")},nav:function(t,i){var r=n(".clearing-blackout").find("ul[data-clearing]");t.preventDefault(),this.go(r,i)},resize:function(){var t=n(".clearing-blackout .visible-img").find("img");t.length&&this.center(t)},fix_height:function(t){var i=t.parent().children(),r=this;return i.each(function(){var t=n(this),i=t.find("img");t.height()>r.outerHeight(i)&&t.addClass("fix-height")}).closest("ul").width(i.length*100+"%"),this},update_paddles:function(n){var t=n.closest(".carousel").siblings(".visible-img");n.next().length>0?t.find(".clearing-main-next").removeClass("disabled"):t.find(".clearing-main-next").addClass("disabled"),n.prev().length>0?t.find(".clearing-main-prev").removeClass("disabled"):t.find(".clearing-main-prev").addClass("disabled")},center:function(n){return this.rtl?n.css({marginRight:-(this.outerWidth(n)/2),marginTop:-(this.outerHeight(n)/2)}):n.css({marginLeft:-(this.outerWidth(n)/2),marginTop:-(this.outerHeight(n)/2)}),this},load:function(n){var t;return(t=n[0].nodeName==="A"?n.attr("href"):n.parent().attr("href"),this.preload(n),t)?t:n.attr("src")},preload:function(n){this.img(n.closest("li").next()).img(n.closest("li").prev())},loaded:function(n,t){function i(){t()}function r(){this.one("load",i);if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var n=this.attr("src"),t=n.match(/\?/)?"&":"?";t+="random="+(new Date).getTime(),this.attr("src",n+t)}}if(!n.attr("src")){i();return}n[0].complete||n[0].readyState===4?i():r.call(n)},img:function(n){if(n.length){var i=new Image,t=n.find("a");i.src=t.length?t.attr("href"):n.find("img").attr("src")}return this},caption:function(n,t){var i=t.data("caption");return i?n.text(i).show():n.text("").hide(),this},go:function(n,t){var r=n.find(".visible"),i=r[t]();i.length&&i.find("img").trigger("click",[r,i])},shift:function(n,t,i){var r=t.parent(),s=this.settings.prev_index||t.index(),u=this.direction(r,n,t),o=parseInt(r.css("left"),10),f=this.outerWidth(t),e;t.index()===s||/skip/.test(u)?/skip/.test(u)&&(e=t.index()-this.settings.up_count,this.lock(),e>0?r.animate({left:-(e*f)},300,this.unlock()):r.animate({left:0},300,this.unlock())):/left/.test(u)?(this.lock(),r.animate({left:o+f},300,this.unlock())):/right/.test(u)&&(this.lock(),r.animate({left:o-f},300,this.unlock())),i()},direction:function(t,i,r){var f=t.find("li"),s=this.outerWidth(f)+this.outerWidth(f)/4,e=Math.floor(this.outerWidth(n(".clearing-container"))/s)-1,u=f.index(r),o;return this.settings.up_count=e,o=this.adjacent(this.settings.prev_index,u)?u>e&&u>this.settings.prev_index?"right":u>e-1&&u<=this.settings.prev_index?"left":!1:"skip",this.settings.prev_index=u,o},adjacent:function(n,t){for(var i=t+1;i>=t-1;i--)if(i===n)return!0;return!1},lock:function(){this.settings.locked=!0},unlock:function(){this.settings.locked=!1},locked:function(){return this.settings.locked},outerHTML:function(n){return n.outerHTML||(new XMLSerializer).serializeToString(n)},off:function(){n(this.scope).off(".fndtn.clearing"),n(t).off(".fndtn.clearing"),this.remove_data(),this.settings.init=!1},reflow:function(){this.init()}}})(Foundation.zj,this,this.document);